<a href="{{ '/' | prepend: site.baseurl }}" class="logo">
  <img src="{{ '/images/logo.png' | prepend: site.baseurl }}">
  Freifunk Darmstadt
</a>
<hr>
<ul>
  {% assign nav_pages = (site.pages | where: 'main_menu', true | sort: 'weight') %}
  {% for p in nav_pages %}
  {% if p.title %}
  <li>
    <a class="{% if p.top_url == page.top_url %} active{% endif %}" href="{% if p.menu_link_url %}{{ p.menu_link_url }}{% else %}{{ p.top_url | prepend: site.baseurl }}{% endif %}">
      {{ p.title }}
    </a>
    {% if p.sub_menu %}
    <ul>
      {% assign sub_pages = (site.pages | where: 'top_url', p.url | sort: 'sub_weight') %}
      {% for s in sub_pages %}
      {% if s.title != p.title %}
      <li>
        <a class="{% if s.url == page.url %} active{% endif %}" href="{{ s.url | prepend: site.baseurl }}">
          {{ s.title }}
        </a>
      </li>
      {% endif %}
      {% endfor %}
    </ul>
    {% endif %}
  </li>
  {% endif %}
  {% endfor %}
</ul>
